
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://wimove-oss.github.io/docs/setup/ansible_setup/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../manual/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.18">
    
    
      
        <title>Setup using Ansible - WiMoVE Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deployment-using-ansible" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="WiMoVE Documentation" class="md-header__button md-logo" aria-label="WiMoVE Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WiMoVE Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Setup using Ansible
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="cyan"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
            
              <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/WiMoVE-oss/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    WiMoVE-oss/docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="WiMoVE Documentation" class="md-nav__button md-logo" aria-label="WiMoVE Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    WiMoVE Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/WiMoVE-oss/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    WiMoVE-oss/docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../architecture/">Architecture Overview</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Architecture Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../design/" class="md-nav__link">
        Design Document
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Setup Guide</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Setup Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Setup using Ansible
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Setup using Ansible
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-to-know-the-components" class="md-nav__link">
    Getting to Know the Components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clone-the-repository" class="md-nav__link">
    Clone the Repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-the-inventory" class="md-nav__link">
    Configure the Inventory
  </a>
  
    <nav class="md-nav" aria-label="Configure the Inventory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-wi-fi-parameters" class="md-nav__link">
    Set Wi-Fi Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-a-log-server" class="md-nav__link">
    Set a Log Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-route-reflector-configuration" class="md-nav__link">
    Set Route Reflector Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-gateway-configuration" class="md-nav__link">
    Set Gateway Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-number-of-vnis" class="md-nav__link">
    Set Number of VNIs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-hosts" class="md-nav__link">
    Setting Hosts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-deploy-to-different-aps" class="md-nav__link">
    (Optional) Deploy to Different APs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gather-binaries" class="md-nav__link">
    Gather Binaries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-openwrt-configuration-files" class="md-nav__link">
    Generate OpenWrt Configuration Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-dependencies-for-ansible-and-running-the-playbook" class="md-nav__link">
    Installing Dependencies for Ansible and Running the Playbook
  </a>
  
    <nav class="md-nav" aria-label="Installing Dependencies for Ansible and Running the Playbook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-dependencies" class="md-nav__link">
    Install Dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-the-run" class="md-nav__link">
    Preparing the Run
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-setup" class="md-nav__link">
    SSH setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-playbook" class="md-nav__link">
    Running the Playbook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../manual/">Manual Setup</a>
          
            <label for="__nav_4_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Manual Setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/parameters/" class="md-nav__link">
        System Parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/access_point/" class="md-nav__link">
        Access Point
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/gateway/" class="md-nav__link">
        Gateway
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/route_reflector/" class="md-nav__link">
        Route Reflector
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-to-know-the-components" class="md-nav__link">
    Getting to Know the Components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clone-the-repository" class="md-nav__link">
    Clone the Repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-the-inventory" class="md-nav__link">
    Configure the Inventory
  </a>
  
    <nav class="md-nav" aria-label="Configure the Inventory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-wi-fi-parameters" class="md-nav__link">
    Set Wi-Fi Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-a-log-server" class="md-nav__link">
    Set a Log Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-route-reflector-configuration" class="md-nav__link">
    Set Route Reflector Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-gateway-configuration" class="md-nav__link">
    Set Gateway Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-number-of-vnis" class="md-nav__link">
    Set Number of VNIs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-hosts" class="md-nav__link">
    Setting Hosts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-deploy-to-different-aps" class="md-nav__link">
    (Optional) Deploy to Different APs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gather-binaries" class="md-nav__link">
    Gather Binaries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-openwrt-configuration-files" class="md-nav__link">
    Generate OpenWrt Configuration Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-dependencies-for-ansible-and-running-the-playbook" class="md-nav__link">
    Installing Dependencies for Ansible and Running the Playbook
  </a>
  
    <nav class="md-nav" aria-label="Installing Dependencies for Ansible and Running the Playbook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-dependencies" class="md-nav__link">
    Install Dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-the-run" class="md-nav__link">
    Preparing the Run
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-setup" class="md-nav__link">
    SSH setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-playbook" class="md-nav__link">
    Running the Playbook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="deployment-using-ansible">Deployment Using Ansible</h1>
<p>This guide will show you how you can install you own WiMoVE setup using our Ansible playbook. The playbook is designed to set up all components (APs, gateway, route reflector). It can however also be used to only set up parts of these components.</p>
<div class="admonition tip">
<p class="admonition-title">Before you get started</p>
<p>It is a very good idea to at least skim over the different steps of this guide so you know what to expect <em>before</em> you try to set up your own system.</p>
</div>
<h2 id="getting-to-know-the-components">Getting to Know the Components</h2>
<p>The parts of this guide will provide information on how to set up each component. Before getting started, please make sure you understand the purpose of each component in the whole system by reading the <a href="../../architecture/">Architecture page</a>.</p>
<p>WiMoVE provides a package you can install on your OpenWrt router (wimoved) but needs some additional services in your network to be useful:</p>
<ul>
<li>The <strong>gateway</strong> is responsible for terminating the overlay networks and provides internet access.</li>
<li>The <strong>route reflector</strong> is part of the control plane. It receives routing information and distributes the information to the access points and the gateway.</li>
</ul>
<h2 id="clone-the-repository">Clone the Repository</h2>
<p>Before you get started, please clone the deployment repository from our GitHub:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/WiMoVE-OSS/deployment.git
</code></pre></div>
<h2 id="configure-the-inventory">Configure the Inventory</h2>
<p>First, you have to set up your Ansible inventory.
This file decides which devices will be provisioned by the Ansible playbook.</p>
<p>To get started, rename the file <code>example-inventory.yml</code> to <code>inventory.yml</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning: A note on IP ranges</p>
<p>This playbook is designed to use the IP range <code>10.0.0.0/8</code> for the virtual L2 networks. If you use (part of) this IP range for your network already, consider modifying the dnsmasq and VXLAN configuration in the gateway folder to suit your requirements.</p>
</div>
<h3 id="set-wi-fi-parameters">Set Wi-Fi Parameters</h3>
<p>First things first, you need to set a name for your wireless network. Put this name in the <code>ssid</code> variable. The passphrase for the network goes into the <code>secret</code> variable.</p>
<p>If you want to use 802.11r fast transition, you have to set the <code>fast_transition</code> variable to 1.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In our testing, we experienced some issues with using FT on some of our APs (especially ZyXel NWA50AX). So make sure your hardware (both AP and stations) support this feature before you enable it in a production environment.</p>
</div>
<h3 id="set-a-log-server">Set a Log Server</h3>
<p>Our Ansible playbook sets up <code>syslog-ng</code> as a syslog backend. It supports forwarding all logs to a log server.
This has proven to be quite useful in our testing setups.
If you want to set up a logging server for yourself, we recommend getting started with <a href="https://github.com/lux4rd0/grafana-loki-syslog-aio" target="_blank">this repository</a>.</p>
<p>If you do not want to use this feature, simply set <code>127.0.0.1</code> as the parameter for <code>log_server</code>, otherwise put the IP/domain of your log server here.</p>
<h3 id="set-route-reflector-configuration">Set Route Reflector Configuration</h3>
<p>Please set the IP address of the route reflector in the variable <code>route_reflector_ip</code>. Additionally, please set an IP range from which the route reflector should accept connections (i.e. <code>10.242.0.0/16</code>) in the <code>listen_range</code> variable.</p>
<h3 id="set-gateway-configuration">Set Gateway Configuration</h3>
<p>For the gateway, you need to additionally configure the names of the network interfaces that are used.</p>
<ul>
<li><code>uplink_if</code> is the interface that will be used for internet access for the overlay networks</li>
<li><code>wimove_if</code> is the interface that will be connected to the L3 environment where all APs can be reached</li>
</ul>
<p>By default, we assume that the same interface is used for both internet access and the APs. If this is not the case, uncomment and edit the <code>wimove_if</code> line in the inventory.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can combine the gateway and route reflector into one machine. To do this, simply put the same host into both the <code>routeReflectors</code> and <code>gateways</code> group.</p>
</div>
<h3 id="set-number-of-vnis">Set Number of VNIs</h3>
<p>You lastly have to decide how many virtual L2 networks you want to provide.</p>
<p>The ansible playbook theoretically supports up to 65.000 VNIs but we recommend starting with a small number (i.e. 20) to get started and scale up later.
The reason for this is the fact that the large number of network interfaces on the gateway can result in a very long boot time which you likely do not want in a testing scenario.</p>
<h3 id="setting-hosts">Setting Hosts</h3>
<p>Take a look at the <em>hosts</em> section of the inventory file.
There, you can see a number of groups. For route reflector and gateway, please insert the corresponding IP addresses.</p>
<p>For the AP section, please put the different types of APs with their names and IP addresses in the inventory.</p>
<h2 id="optional-deploy-to-different-aps">(Optional) Deploy to Different APs</h2>
<p>The Ansible playbook currently supports two different types of APs. <code>zyxel</code> and <code>linksys</code>. If you want to have more or other models, you just have to create the directories and in <code>roles/access-point/{files,templates}/model-name</code>. Then you can add a new group to the children of the group <code>openwrt</code> in the inventory and set the <code>directory</code> variable accordingly. Then follow the next steps.</p>
<h2 id="gather-binaries">Gather Binaries</h2>
<ol>
<li>Find out which architecture your access point uses by looking it up on the <a href="https://openwrt.org/toh/start">OpenWrt Table of Hardware</a>.</li>
<li>Download the package for the matching architecture for your access point. There are three ways to achieve this:<ol>
<li>Download the binary from the latest release on the <a href="https://github.com/WiMoVE-OSS/wimoved/releases">Releases Page</a></li>
<li>Download the binary from a recent pipeline run in our <a href="https://github.com/WiMoVE-OSS/wimoved">GitHub Repository</a></li>
<li>Cross-Compile it yourself. See the <a href="https://github.com/WiMoVE-OSS/wimoved">Development Guide</a> for details.</li>
</ol>
</li>
<li>Place the binary in the corresponding folder for your AP type. The filepath is <code>roles/access-point/files/model-name</code>. Make sure that it has the file extension <code>.ipk</code> and it is the only <code>.ipk</code> file in that directory.</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use arbitrary model names. The <code>directory</code> variable for a host only has to match the directory name in <code>roles/access-points/files</code> to get the correct binary.</p>
</div>
<h2 id="generate-openwrt-configuration-files">Generate OpenWrt Configuration Files</h2>
<p>Since each AP is different, you need different configuration files for each model.
For this reason, we do not provide complete configuration files but rather guide you how to create them yourself.</p>
<ol>
<li>Go to the web interface of one of your APs running OpenWrt and configure a WPA2-PSK wireless network for each radio you wish to use. You can set any SSID and password, you will overwrite them in a minute. Make sure to press save at the end.</li>
<li>
<p>Open an SSH console to the AP and run</p>
<p><div class="highlight"><pre><span></span><code>uci<span class="w"> </span><span class="nb">export</span>
</code></pre></div>
to export the configuration for the AP.</p>
</li>
<li>
<p>Copy the output of the command and place it in a file called <code>config.ota.j2</code> in the folder <code>roles/access-point/templates/model-name</code> that corresponds to your AP type in the ansible playbook.</p>
</li>
<li>Open the file in a text editor.</li>
<li>Go to the end of the file. There, you should find a section for each wireless network you configured in the previous step.</li>
<li>
<p>Adjust each of these <code>wifi-iface</code> sections so that they contain the following lines:</p>
<div class="highlight"><pre><span></span><code>option ssid &#39;{{ ssid }}&#39;
option isolate &#39;1&#39;
option key &#39;{{ secret }}&#39;
option ieee80211r &#39;{{ fast_transition }}&#39;
option mobility_domain &#39;0101&#39;
option reassociation_deadline &#39;1000&#39;
option ft_over_ds &#39;{{ ft_over_ds }}&#39;
option ft_psk_generate_local &#39;1&#39;
option per_sta_vif &#39;1&#39;
option vlan_file &#39;/etc/hostapd.vlan&#39;
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure that there are no two lines with the same name in each of the <code>wifi-iface</code> sections of the file. Otherwise, OpenWrt will later not accept the configuration.</p>
</div>
</li>
</ol>
<h2 id="installing-dependencies-for-ansible-and-running-the-playbook">Installing Dependencies for Ansible and Running the Playbook</h2>
<p>You have now configured all parameters for your Wi-Fi setup. Congratulations!</p>
<p>Now, all that is left to do is to actually deploy it on your hardware.</p>
<h3 id="install-dependencies">Install Dependencies</h3>
<p>We use an Ansible plugin to provision OpenWrt. This plugin needs to be installed by running
<div class="highlight"><pre><span></span><code>ansible-galaxy<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.yml
</code></pre></div>
in the repo folder.</p>
<h3 id="preparing-the-run">Preparing the Run</h3>
<p>Before you run the playbook, you have to make sure that you can connect to all APs and other machines via SSH.
For this to work properly, you have to set up SSH key authentication on each of the devices.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To copy your SSH key to your APs, you can either use the OpenWrt web interface or the typical <code>ssh-copy-id</code> command.</p>
</div>
<h3 id="ssh-setup">SSH setup</h3>
<p>Please make sure that your SSH config file contains all the hostnames you gave to the hosts in your inventory. Otherwise, when running the playbook you will get an error that the name could not be resolved.</p>
<h3 id="running-the-playbook">Running the Playbook</h3>
<div class="admonition warning">
<p class="admonition-title">Before you run the playbook: A note on SSH key passphrases</p>
<p>Ansible attempts to open multiple SSH connections over the process of running a playbook. If you have configured a passphrase for your private key (as is generally a good idea), this will result in many password prompts.</p>
<p>To prevent this, we recommend using <code>ssh-agent</code> to cache the unencrypted private key in the current terminal.</p>
<p>To get started, open the terminal in which you want to run ansible later.
Then execute
<div class="highlight"><pre><span></span><code><span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>ssh-agent<span class="w"> </span>-s<span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>
to start ssh-agent. Now, you need to load your private key by running (depending on the location of your key file)
<div class="highlight"><pre><span></span><code>ssh-add<span class="w"> </span>~/.ssh/id_rsa
</code></pre></div>
This will prompt you for the passphrase of your key. After you entered the passphrase, you will not be prompted for it again in that terminal session.</p>
</div>
<p>To finally run the playbook, execute
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>install.yml<span class="w"> </span>-K
</code></pre></div></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Setup Guide" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Setup Guide
              </div>
            </div>
          </a>
        
        
          
          <a href="../manual/" class="md-footer__link md-footer__link--next" aria-label="Next: Manual Setup" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Manual Setup
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      ðŸ…­ ðŸ…¯ ðŸ„Ž Attribution-ShareAlike 4.0 <a href='https://creativecommons.org/licenses/by-sa/4.0/'>CC BY SA</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/WiMoVE-OSS/wimoved/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.indexes", "content.code.copy", "navigation.footer"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>